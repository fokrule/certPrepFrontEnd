<div class="result-container" *ngIf="result">
  <mat-card class="result-card">
    <mat-card-header>
      <mat-card-title>{{ result.testTitle }} - Results</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <div class="score-section">
        <h2 class="score" [ngClass]="scoreColor">{{ result.score }}%</h2>
        <p class="score-detail">
          {{ result.correctCount }} correct out of {{ result.total }} questions
        </p>
        <p class="message" [ngClass]="scoreColor">
          {{ result.passed ? 'Congratulations! You passed!' : 'Better luck next time!' }}
        </p>
      </div>

      <h3>Question Breakdown</h3>
      <div class="questions-list">
        @for (item of result.details; track item.questionId) {
          <div class="question-item" [ngClass]="{ correct: item.isCorrect, incorrect: !item.isCorrect }">
            <div class="question-header">
              <mat-icon *ngIf="item.isCorrect">check_circle</mat-icon>
              <mat-icon *ngIf="!item.isCorrect">cancel</mat-icon>
              <span class="question-text">{{ item.text }}</span>
            </div>
            <div class="answer-info">
              <p><strong>Your answer:</strong> {{ item.selected }}</p>
              <p><strong>Correct answer:</strong> {{ item.correct }}</p>
            </div>
          </div>
        }
      </div>
    </mat-card-content>

    <mat-card-actions class="actions">
      <button mat-raised-button color="primary" (click)="retakeTest()">
        Retake Test
      </button>
      <button mat-stroked-button (click)="backToTests()">
        Back to All Tests
      </button>
    </mat-card-actions>
  </mat-card>
</div>

<div *ngIf="!result" class="loading">
  <mat-spinner></mat-spinner>
  <p>Loading results...</p>
</div>